# Руководство по конфигурации модуля авторизации проекта Химера 2.0

**Файл:** 
- config/settings_auth.py

---

## AUTH ACTOR SETTINGS

### Проверка схемы БД
- `AUTH_SCHEMA_CHECK_TIMEOUT` - таймаут проверки существования таблиц авторизации в секундах (по умолчанию: 5.0)
  - Защищает от зависания при проблемах с БД
  - Рекомендация: 3-10 секунд

### Фоновые задачи
- `AUTH_CLEANUP_INTERVAL` - интервал очистки старых данных авторизации в секундах (по умолчанию: 3600 = 1 час)
  - Очищает старые записи из auth_attempts
  - Удаляет истекшие блокировки из blocked_users
  - Установите 0 для отключения очистки

- `AUTH_METRICS_LOG_INTERVAL` - интервал логирования метрик AuthActor в секундах (по умолчанию: 300 = 5 минут)
  - Выводит статистику проверок лимитов и авторизаций
  - Показывает процент успешных авторизаций
  - Установите 0 для отключения периодических метрик

### Рекомендации по настройке

**Для разработки:**
- AUTH_SCHEMA_CHECK_TIMEOUT = 5.0
- AUTH_CLEANUP_INTERVAL = 300 (5 минут)
- AUTH_METRICS_LOG_INTERVAL = 60 (1 минута)

**Для production:**
- AUTH_SCHEMA_CHECK_TIMEOUT = 3.0
- AUTH_CLEANUP_INTERVAL = 3600 (1 час)
- AUTH_METRICS_LOG_INTERVAL = 300 (5 минут)

---

## AUTHORIZATION SETTINGS

### Параметры паролей
- `PASSWORD_DURATIONS` - список допустимых сроков действия паролей в днях (по умолчанию: [30, 90, 180, 365])
  - Используется при создании новых паролей администратором
  - Проверяется при валидации в Pydantic моделях

### Anti-bruteforce защита
- `AUTH_MAX_ATTEMPTS` - количество неудачных попыток авторизации до блокировки (по умолчанию: 5)
- `AUTH_BLOCK_DURATION` - длительность блокировки пользователя в секундах (по умолчанию: 900 = 15 минут)
- `AUTH_ATTEMPTS_WINDOW` - окно времени для подсчета неудачных попыток в секундах (по умолчанию: 900 = 15 минут)
  - Попытки старше этого времени не учитываются при подсчете
  - Должно быть равно или больше AUTH_BLOCK_DURATION

### Администрирование
- `ADMIN_USER_IDS` - список telegram_id пользователей с правами администратора (по умолчанию: [502312936])
  - Только эти пользователи могут использовать админские команды
  - Добавляйте ID через запятую: [502312936, 123456789]

### Интеграция с системой
- `AUTH_CHECK_TIMEOUT` - таймаут ожидания ответа от AuthActor при проверке лимитов (по умолчанию: 2.0 секунды)
- `AUTH_FALLBACK_TO_DEMO` - разрешить работу в демо-режиме если AuthActor недоступен (по умолчанию: True)
  - True = при недоступности AuthActor пользователи работают с демо-лимитами
  - False = при недоступности AuthActor доступ блокируется
- `AUTH_ATTEMPTS_WINDOW` - окно подсчета попыток в секундах (по умолчанию: 900)
- `AUTH_DAILY_RESET_ENABLED` - включить ежедневный сброс счетчиков (по умолчанию: True)
- `AUTH_DAILY_RESET_HOUR` - час сброса в UTC (по умолчанию: 0)
- `AUTH_CIRCUIT_BREAKER_ENABLED` - включить Circuit Breaker для AUTH_REQUEST (по умолчанию: True)
- `AUTH_CIRCUIT_BREAKER_THRESHOLD` - количество ошибок для открытия (по умолчанию: 3)
- `AUTH_CIRCUIT_BREAKER_TIMEOUT` - время восстановления в секундах (по умолчанию: 300)
